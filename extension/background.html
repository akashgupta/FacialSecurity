<html>
  <body>
    <script>
    var url = "";
      chrome.extension.onRequest.addListener(function(request, sender) {
        chrome.tabs.update(sender.tab.id, {url: request.redirect + "?ref=" + url});
      });

	window.addEventListener("load", windowLoaded, false);
	    function windowLoaded() {
	      chrome.tabs.getSelected(null, function(tab) {
		  url = tab.url;
	      });
	}
    </script>
  </body>
</html>
